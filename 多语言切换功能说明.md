# 多语言切换功能说明

## 功能概述

MongoDB Compass 客户端现已支持多语言切换功能，用户可以在简体中文、繁体中文和英文之间自由切换，提供更好的国际化体验。

## 支持的语言

- **简体中文 (zhcn)** - 默认语言
- **繁体中文 (zhtw)** - 繁体中文界面
- **英文 (en)** - 英文界面

## 功能特性

### 1. 语言管理核心 (LanguageManager.cs)

- **自动语言文件创建**: 首次运行时自动创建语言文件
- **语言设置持久化**: 记住用户的语言选择
- **动态语言切换**: 支持运行时切换语言
- **事件驱动更新**: 语言切换时自动更新所有界面

### 2. 界面元素多语言化

#### 主菜单
- 连接菜单 (连接、连接配置、重新连接、刷新)
- 工具菜单 (原生语句)
- 语言菜单 (英语、简体中文、繁体中文、语言设置)

#### 对话框和窗体
- 连接配置对话框
- 连接列表窗体
- 语言设置对话框
- 各种操作确认对话框

#### 按钮和标签
- 所有操作按钮 (连接、保存、取消、添加、编辑、删除等)
- 状态栏文本
- 错误和提示消息

### 3. 语言切换方式

#### 方式一：菜单切换
1. 点击主菜单 "语言"
2. 选择目标语言 (英语/简体中文/繁体中文)
3. 界面立即更新为新语言

#### 方式二：语言设置对话框
1. 点击主菜单 "语言" → "语言设置"
2. 在对话框中选择语言
3. 点击确定应用更改

### 4. 语言文件管理

#### 文件位置
```
应用程序目录/
├── language/
│   ├── zhcn.ini    # 简体中文
│   ├── zhtw.ini    # 繁体中文
│   └── en.ini      # 英文
└── language_config.ini  # 语言设置配置文件
```

#### 语言文件格式
```ini
# 主菜单
menu_connection=连接
menu_connect=连接配置
menu_reconnect=重新连接

# 按钮文本
btn_connect=连接
btn_cancel=取消
btn_ok=确定

# 对话框标题
dialog_connect=连接配置
dialog_error=错误
dialog_info=信息

# 消息文本
msg_connection_success=连接成功！
msg_connection_failed=连接失败：{0}
```

## 技术实现

### 1. 核心类结构

```csharp
public static class LanguageManager
{
    // 语言切换事件
    public static event EventHandler LanguageChanged;
    
    // 支持的语言列表
    public static readonly Dictionary<string, string> SupportedLanguages;
    
    // 核心方法
    public static void Initialize();
    public static void LoadLanguage(string languageCode);
    public static void SwitchLanguage(string languageCode);
    public static string GetString(string key, string defaultValue = "");
    public static string GetCurrentLanguage();
}
```

### 2. 事件驱动更新机制

```csharp
// 窗体绑定语言切换事件
LanguageManager.LanguageChanged += LanguageManager_LanguageChanged;

// 事件处理方法
private void LanguageManager_LanguageChanged(object sender, EventArgs e)
{
    if (this.InvokeRequired)
    {
        this.Invoke(new Action(() => ApplyLanguageToUI()));
    }
    else
    {
        ApplyLanguageToUI();
    }
}
```

### 3. 界面更新方法

```csharp
private void ApplyLanguageToUI()
{
    // 更新菜单文本
    menuItemConnection.Text = LanguageManager.GetString("menu_connection", "连接");
    
    // 更新窗体标题
    this.Text = LanguageManager.GetString("form_title", "MongoDB Compass");
    
    // 更新按钮文本
    buttonConnect.Text = LanguageManager.GetString("btn_connect", "连接");
    
    // 更新状态栏
    SetStatus(LanguageManager.GetString("status_ready", "就绪"));
}
```

## 使用说明

### 1. 切换语言
1. 启动应用程序
2. 点击主菜单 "语言"
3. 选择目标语言
4. 界面将立即更新为新语言

### 2. 自定义语言文件
1. 找到 `language` 目录
2. 编辑对应的语言文件 (zhcn.ini, zhtw.ini, en.ini)
3. 添加或修改翻译条目
4. 重启应用程序应用更改

### 3. 添加新语言支持
1. 在 `LanguageManager.cs` 中添加新语言到 `SupportedLanguages`
2. 创建对应的语言文件 (如 ja.ini 用于日语)
3. 实现 `GetDefaultJapaneseStrings()` 方法
4. 在 `CreateDefaultLanguageFiles()` 中添加新语言文件创建

## 翻译条目分类

### 1. 菜单相关
- `menu_*` - 主菜单项
- `submenu_*` - 子菜单项

### 2. 按钮相关
- `btn_*` - 按钮文本

### 3. 对话框相关
- `dialog_*` - 对话框标题
- `label_*` - 标签文本

### 4. 消息相关
- `msg_*` - 提示消息
- `error_*` - 错误消息
- `tip_*` - 提示信息

### 5. 状态相关
- `status_*` - 状态栏文本

### 6. 占位符相关
- `placeholder_*` - 输入框占位符

## 注意事项

1. **语言文件编码**: 所有语言文件使用 UTF-8 编码
2. **占位符支持**: 消息文本支持 `{0}`, `{1}` 等占位符
3. **线程安全**: 语言切换事件在主线程中处理
4. **错误处理**: 语言文件加载失败时使用默认语言
5. **性能优化**: 语言字符串缓存，避免重复文件读取

## 扩展功能

### 1. 自动语言检测
可以根据系统语言自动选择初始语言：

```csharp
private static string DetectSystemLanguage()
{
    string systemLang = CultureInfo.CurrentUICulture.Name.ToLower();
    if (systemLang.StartsWith("zh"))
    {
        return systemLang.Contains("tw") || systemLang.Contains("hk") ? "zhtw" : "zhcn";
    }
    return "en";
}
```

### 2. 语言包热更新
支持运行时加载新的语言包：

```csharp
public static void ReloadLanguageFiles()
{
    // 重新加载语言文件
    LoadLanguage(currentLanguage);
}
```

### 3. 自定义语言包
用户可以创建自定义语言包：

```csharp
public static void LoadCustomLanguage(string languageCode, string filePath)
{
    // 加载自定义语言文件
}
```

## 总结

多语言切换功能为 MongoDB Compass 客户端提供了完整的国际化支持，用户可以根据需要选择合适的界面语言，提升了软件的用户体验和可用性。该功能采用事件驱动架构，支持动态语言切换，具有良好的扩展性和维护性。 