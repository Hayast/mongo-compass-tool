# 批量删除功能说明

## 功能概述
在右边的集合TAB中添加了"批量删除"按钮，允许用户一次性删除多条选中的记录。

## 功能特点

### 1. 按钮位置
- 位置：集合TAB页面的工具栏
- 按钮名称：批量删除
- 按钮颜色：红色 (Color.FromArgb(220, 53, 69))
- 位置顺序：在"删除记录"按钮之后

### 2. 功能逻辑
- **选择验证**：检查是否有选中的记录
- **数量验证**：如果只选择1条记录，提示用户使用"删除记录"按钮
- **确认对话框**：显示选中记录数量，要求用户确认删除操作
- **批量删除**：使用MongoDB的`DeleteMany`操作一次性删除所有选中记录
- **界面更新**：删除成功后从DataGridView中移除对应的行

### 3. 安全机制
- 删除前显示确认对话框，包含选中记录数量
- 明确提示"此操作不可撤销"
- 详细的错误处理和状态反馈

## 实现细节

### 1. 工具栏按钮添加
在`CreateToolbarButtons`方法中添加了批量删除按钮：
```csharp
// 批量删除按钮
Button btnBatchDelete = CreateToolbarButton("批量删除", currentX, buttonWidth, buttonHeight, Color.FromArgb(220, 53, 69));
btnBatchDelete.Click += (s, e) => BatchDeleteSelectedRecords(databaseName, collectionName);
toolbarPanel.Controls.Add(btnBatchDelete);
```

### 2. 批量删除方法实现
新增`BatchDeleteSelectedRecords`方法，主要功能：

#### 数据验证
- 检查当前选中的Tab页
- 验证DataGridView和选中行
- 确保选中多条记录（至少2条）

#### 数据收集
- 从每个选中行的Tag中获取BsonDocument
- 提取所有记录的`_id`字段
- 保存对应的DataGridViewRow引用

#### 批量操作
- 使用`Builders<BsonDocument>.Filter.In("_id", idValues)`构建过滤器
- 调用`collection.DeleteMany(filter)`执行批量删除
- 根据删除结果更新界面

#### 界面更新
- 从DataGridView中移除已删除的行
- 显示删除成功消息
- 更新状态栏信息

## 使用方法

1. **选择记录**：在集合TAB中按住Ctrl键选择多条记录
2. **点击按钮**：点击工具栏中的"批量删除"按钮
3. **确认删除**：在弹出的确认对话框中点击"是"
4. **查看结果**：查看删除结果和状态栏信息

## 错误处理

### 常见错误情况
- 未选择记录：提示"请先选择要删除的记录"
- 只选择1条记录：提示使用"删除记录"按钮
- 无法获取_id字段：提示"无法获取选中记录的 _id 字段"
- 删除失败：显示具体错误信息

### 状态反馈
- 成功：绿色状态栏显示删除数量
- 失败：红色状态栏显示错误信息
- 完成：弹出消息框显示操作结果

## 技术特点

### 1. 性能优化
- 使用`DeleteMany`而不是循环调用`DeleteOne`
- 一次性构建包含所有_id的过滤器
- 减少数据库交互次数

### 2. 用户体验
- 清晰的操作提示和确认
- 实时的界面更新
- 详细的状态反馈

### 3. 数据安全
- 严格的验证机制
- 明确的确认对话框
- 完整的错误处理

## 与现有功能的区别

| 功能 | 删除记录 | 批量删除 |
|------|----------|----------|
| 适用场景 | 单条记录删除 | 多条记录删除 |
| 选择要求 | 1条记录 | 2条或以上记录 |
| 操作方式 | DeleteOne | DeleteMany |
| 确认方式 | 简单确认 | 详细确认（显示数量）|

## 注意事项

1. **数据备份**：批量删除操作不可撤销，建议在重要操作前备份数据
2. **选择确认**：确保正确选择了要删除的记录
3. **权限检查**：确保有足够的数据库删除权限
4. **性能考虑**：大量记录删除时可能需要较长时间 